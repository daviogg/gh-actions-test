name: Deploy to environments

on:
  push:
    branches:
      - main
  workflow_dispatch:
    # Only allow manual triggers for the release job
    inputs:
      environment:
        description: 'Environment to deploy to'
        required: true
        default: 'staging'
        # Validate the input is either 'staging' or 'production'
        # by listing it as an option in the select control
        options: ['staging', 'production']

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: staging
      url: https://staging.example.com/$SECRET_NAME
    steps:
      - name: Deploy to staging
        env:
          SECRET_NAME: ${{ secrets.STAGING_SECRET }}
        run: echo "Deploying to staging environment with secret $SECRET_NAME"

  release:
    needs: deploy
    runs-on: ubuntu-latest
    environment:
      name: ${{ github.event.inputs.environment }} # Use the selected environment
      url: https://example.com/$SECRET_NAME
    steps:
      - name: Deploy to production or staging
        env:
          SECRET_NAME: ${{ secrets.PRODUCTION_SECRET }} # Use the production secret by default
        run: echo "Deploying to ${{ github.event.inputs.environment }} environment with secret $SECRET_NAME"
